{
  "info": {
    "_postman_id": "83368588-9985-40f6-9df5-fde66e9a84d4",
    "name": "GameServer - End-to-end test",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "OAuth2",
      "item": [
        {
          "name": "OAuth2-Auth",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "d5d79272-48e7-49bf-af01-8b481e69f0ba",
                "exec": [
                  "pm.test(\"response is ok\",  ()=>{\r",
                  "if( pm.response.to.have.status(200))\r",
                  "{\r",
                  "    var txt = pm.response.text();\r",
                  "    var jsonData = JSON.parse(txt);\r",
                  "    var envState = pm.collectionVariables.get(\"vars.state\");\r",
                  "    if ( jsonData.code != \"\" && jsonData.state == envState )\r",
                  "    {\r",
                  "        console.log(\"Setting code:\" + jsonData.code);\r",
                  "        pm.collectionVariables.set(\"vars.code\", jsonData.code);\r",
                  "        return;\r",
                  "    }\r",
                  "\r",
                  "    // Fail    \r",
                  "    pm.expect.fail();\r",
                  "}})"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "7c5d8367-79b4-4867-a56b-9cbbbe7f6816",
                "exec": [
                  "function generateRandomStringShort() {",
                  "  return Math.random().toString(36).slice(2);",
                  "}",
                  "",
                  "var state = generateRandomStringShort();",
                  "pm.collectionVariables.set(\"vars.state\", state);",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "id": "cf5c0282-758c-43b0-9300-4373b2afed0d",
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"clientId\": \"{{ClientId}}\",\r\n  \"clientSecret\": \"{{ClientSecret}}\",\r\n  \"redirectUri\": \"{{redirectUri}}\",\r\n  \"scope\": \"{{ClientScope}}\",\r\n  \"state\": \"{{vars.state}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{server_address}}/Account/auth",
              "host": [
                "{{server_address}}"
              ],
              "path": [
                "Account",
                "auth"
              ]
            }
          },
          "response": []
        },
        {
          "name": "OAuth2-Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "1831b76f-d485-4771-90f3-5cb5772e2fd5",
                "exec": [
                  "pm.test(\"response is ok\",  ()=>{\r",
                  "if( pm.response.to.have.status(200))\r",
                  "{\r",
                  "    var txt = pm.response.text();\r",
                  "    var jsonData = JSON.parse(txt);\r",
                  "    if (jsonData.errorCode == 0)\r",
                  "    {\r",
                  "        console.log(\"Setting access_token:\" + jsonData.accessToken);\r",
                  "        pm.collectionVariables.set(\"vars.access_token\", jsonData.accessToken);\r",
                  "        return;\r",
                  "    }\r",
                  "\r",
                  "    // Fail the test since login fails\r",
                  "    pm.expect.fail();\r",
                  "}})"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "ad7b283d-3c74-4004-b65b-72a608d5f0fc",
                "exec": [
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "id": "2781c2b1-3fbf-4f83-9aa9-e0f7d1fd476c",
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"code\": \"{{vars.code}}\",\r\n  \"state\": \"{{vars.state}}\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{server_address}}/Account/code",
              "host": [
                "{{server_address}}"
              ],
              "path": [
                "Account",
                "code"
              ]
            }
          },
          "response": []
        }
      ],
      "id": "145d167a-69ba-4da4-874a-32abb27c4557"
    },
    {
      "name": "Account",
      "item": [
        {
          "name": "CreateAccount",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "e556aae5-e69c-4249-800a-36871aababaf",
                "exec": [
                  "pm.test(\"response is ok\",  ()=>{\r",
                  "if( pm.response.to.have.status(200))\r",
                  "{\r",
                  "    var txt = pm.response.text();\r",
                  "    var jsonData = JSON.parse(txt);\r",
                  "    console.log(\"Setting code:\" + jsonData.token);\r",
                  "    pm.collectionVariables.set(\"vars.login_token\", jsonData.token);\r",
                  "}})"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c15abde5-0e27-4a6b-8ac5-f069ccc34c5e",
                "exec": [
                  "function generateRandomStringShort() {\r",
                  "  return Math.random().toString(36).slice(2);\r",
                  "}\r",
                  "\r",
                  "var username = \"User\" + generateRandomStringShort();\r",
                  "var nickname = \"Nick\" + generateRandomStringShort();\r",
                  "var password = \"cGVwc2ltYXg=\";\r",
                  "pm.collectionVariables.set(\"vars.login_username\", username);\r",
                  "pm.collectionVariables.set(\"vars.login_nickname\", nickname);\r",
                  "pm.collectionVariables.set(\"vars.login_password\", password);\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "id": "34735d5e-fa44-44d1-a810-8e824b49bcb9",
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"username\": \"{{vars.login_username}}\",\r\n  \"password\": \"{{vars.login_password}}\",\r\n  \"nickname\": \"{{vars.login_nickname}}\",\r\n  \"email\": \"{{vars.login_username}}@email.com\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{server_address}}/Account/CreateAccount",
              "host": [
                "{{server_address}}"
              ],
              "path": [
                "Account",
                "CreateAccount"
              ]
            }
          },
          "response": []
        },
        {
          "name": "LoginUser",
          "id": "e0bbc79a-95d9-423c-b0ca-f8c8a2e46e7a",
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"username\": \"{{login_username}}\",\r\n  \"password\": \"cGVwc2ltYXg=\"\r\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{server_address}}/Account/LoginAccount",
              "host": [
                "{{server_address}}"
              ],
              "path": [
                "Account",
                "LoginAccount"
              ]
            }
          },
          "response": []
        }
      ],
      "id": "4717934d-3528-4819-adde-65f868072787"
    },
    {
      "name": "Playfield",
      "item": [],
      "id": "7b0c5763-51aa-4241-ab49-aa87bc453259"
    },
    {
      "name": "Cleanup",
      "item": [
        {
          "name": "DeleteAccount",
          "id": "5179e888-e3b7-4924-893a-6a2e7655338e",
          "request": {
            "method": "PUT",
            "header": [],
            "url": {
              "raw": "{{server_address}}/Account/DeleteAccount",
              "host": [
                "{{server_address}}"
              ],
              "path": [
                "Account",
                "DeleteAccount"
              ]
            }
          },
          "response": []
        }
      ],
      "id": "0c890077-1b77-4aff-aef7-99036b949cb1"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{vars.access_token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "da165398-03f5-4c89-a466-fbf9fe8cada8",
        "type": "text/javascript",
        "packages": {},
        "requests": {},
        "exec": [
          "// ",
          "// Remove all temp variables",
          "//",
          "//pm.collectionVariables.clear();",
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "bd7e2ab2-8130-417f-842e-c415cc09676c",
        "type": "text/javascript",
        "packages": {},
        "requests": {},
        "exec": [
          "// ",
          "// Remove all temp variables",
          "//",
          "//pm.collectionVariables.clear();",
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "56acba39-7d14-4b09-a395-751b0af4acb9",
      "key": "vars.access_token",
      "value": ""
    },
    {
      "id": "c4ddd021-dedf-4e60-81d4-17e5afbe9f70",
      "key": "vars.state",
      "value": ""
    },
    {
      "id": "47124b90-f66d-4af2-ae4b-2cf8b6904518",
      "key": "vars.code",
      "value": ""
    },
    {
      "id": "25020304-1245-4be3-bdfa-19488df3eceb",
      "key": "vars.login_username",
      "value": ""
    },
    {
      "id": "df0418da-0cac-4ea9-8b45-34a41a9276b3",
      "key": "vars.login_nickname",
      "value": ""
    },
    {
      "id": "5e95fc32-1373-40ce-9d3c-ed3c63def633",
      "key": "vars.login_password",
      "value": ""
    },
    {
      "id": "58510d8e-23ec-4bb3-b8c2-71379af000fe",
      "key": "vars.login_token",
      "value": ""
    }
  ]
}